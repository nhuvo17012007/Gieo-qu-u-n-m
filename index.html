<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gieo Qu·∫ª ƒê·∫ßu Xu√¢n 2026 | Check VAR V·∫≠n M·ªánh</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">
    <!-- Th∆∞ vi·ªán ch·ª•p ·∫£nh m√†n h√¨nh -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root {
            --tet-red: #D72638;
            --tet-dark-red: #A01A28;
            --tet-gold: #FFD700;
            --tet-orange: #FF9F1C;
            --tet-cream: #FFF8E7;
            --card-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: radial-gradient(circle at center, var(--tet-red), var(--tet-dark-red));
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--tet-cream);
            overflow-x: hidden;
            position: relative;
        }

        /* Background Pattern */
        body::before {
            content: "üå∏ üåº üßß üß® üå∏ üåº";
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            font-size: 2rem;
            opacity: 0.05;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            align-content: space-around;
            z-index: -1;
            pointer-events: none;
            user-select: none;
        }

        /* Container ch√≠nh */
        .container {
            width: 90%;
            max-width: 450px;
            text-align: center;
            padding: 20px;
            z-index: 10;
        }

        /* Header */
        h1 {
            font-family: 'Pacifico', cursive;
            font-size: 2.5rem;
            color: var(--tet-gold);
            text-shadow: 2px 2px 0px #8b0000;
            margin-bottom: 5px;
            animation: textSparkle 2s infinite alternate;
        }

        .subtitle {
            font-size: 1.1rem;
            background: rgba(255, 255, 255, 0.2);
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(5px);
            border: 1px solid var(--tet-gold);
        }

        /* Form nh·∫≠p li·ªáu */
        .input-group {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 15px;
            box-shadow: var(--card-shadow);
            margin-bottom: 25px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            transition: transform 0.3s ease;
        }

        .input-group input {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s;
            text-align: center;
            color: #333;
        }

        .input-group input:focus {
            border-color: var(--tet-red);
        }

        button.btn-gieo {
            background: linear-gradient(45deg, var(--tet-orange), var(--tet-red));
            color: white;
            border: none;
            padding: 12px;
            font-size: 1.2rem;
            font-weight: 800;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(215, 38, 56, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
            text-transform: uppercase;
        }

        button.btn-gieo:active {
            transform: scale(0.95);
        }

        button.btn-gieo:hover {
            box-shadow: 0 6px 20px rgba(215, 38, 56, 0.6);
        }

        /* 3D Card Flip Effect */
        .scene {
            width: 100%;
            height: 500px; /* TƒÉng chi·ªÅu cao x√≠u ƒë·ªÉ ch·ª©a n√∫t */
            perspective: 1000px;
            margin-top: 10px;
            display: none;
        }

        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
            cursor: pointer;
        }

        .card.is-flipped {
            transform: rotateY(180deg);
        }

        .card__face {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 4px solid var(--tet-gold);
        }

        .card__face--front {
            background: linear-gradient(135deg, #ff0000, #990000);
            color: var(--tet-gold);
        }

        .front-decor {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: spinSlow 10s linear infinite;
        }

        .front-text {
            font-family: 'Pacifico', cursive;
            font-size: 2rem;
        }

        /* M·∫∑t sau (K·∫øt qu·∫£) */
        .card__face--back {
            background: #fff;
            color: #333;
            transform: rotateY(180deg);
            padding: 20px;
            justify-content: flex-start;
            position: relative;
        }

        /* N·ªôi dung b√™n trong th·∫ª ƒë·ªÉ ch·ª•p ·∫£nh (kh√¥ng bao g·ªìm n√∫t) */
        .card-content-wrapper {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #fff; /* ƒê·∫£m b·∫£o n·ªÅn tr·∫Øng khi ch·ª•p */
            padding: 5px;
            border-radius: 15px;
        }

        .card-header {
            font-weight: 800;
            color: var(--tet-red);
            font-size: 1.1rem;
            text-transform: uppercase;
            margin-bottom: 10px;
            border-bottom: 2px dashed var(--tet-gold);
            width: 100%;
            padding-bottom: 5px;
            text-align: center;
        }

        .user-name-display {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }

        .fortune-status {
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--tet-dark-red);
            margin: 10px 0;
            line-height: 1.3;
            text-align: center;
        }

        .stats-container {
            width: 100%;
            background: #f9f9f9;
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            font-size: 0.95rem;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            align-items: center;
        }

        .stat-label { font-weight: 600; color: #555; }
        .stat-value { font-weight: 800; color: var(--tet-orange); }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #eee;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 2px;
        }
        .progress-fill {
            height: 100%;
            background: var(--tet-red);
            transition: width 1s ease-out;
        }

        .surprise-box {
            background: var(--tet-cream);
            border: 1px solid var(--tet-gold);
            padding: 8px;
            border-radius: 8px;
            width: 100%;
            text-align: center;
            margin-bottom: 10px;
        }
        .surprise-title { font-size: 0.8rem; color: #888; text-transform: uppercase; }
        .surprise-content { font-weight: bold; color: #333; font-size: 0.95rem; }

        .advice-quote {
            font-style: italic;
            font-size: 0.9rem;
            color: #555;
            margin-top: 10px;
            margin-bottom: 15px;
            text-align: center;
            border-left: 3px solid var(--tet-gold);
            padding-left: 10px;
        }

        /* Khu v·ª±c n√∫t b·∫•m */
        .action-buttons {
            display: flex;
            gap: 10px;
            width: 100%;
            margin-top: auto;
        }

        .btn-action {
            flex: 1;
            border: none;
            padding: 10px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            transition: transform 0.2s, opacity 0.2s;
            color: #fff;
        }

        .btn-action:active { transform: scale(0.95); }

        .btn-copy { background: #333; }
        .btn-copy:hover { background: #555; }

        .btn-download { background: var(--tet-orange); }
        .btn-download:hover { background: #e08e1a; }

        /* Toast Message */
        #toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 50px;
            padding: 16px;
            position: fixed;
            z-index: 100;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            font-size: 1rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            opacity: 0;
            transition: opacity 0.5s, bottom 0.5s;
        }

        #toast.show {
            visibility: visible;
            opacity: 1;
            bottom: 50px;
        }

        #confetti-canvas {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 99;
        }

        /* Animations */
        @keyframes textSparkle {
            from { text-shadow: 2px 2px 0px #8b0000; }
            to { text-shadow: 2px 2px 10px #FFD700; }
        }

        @keyframes spinSlow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @media (max-width: 400px) {
            h1 { font-size: 2rem; }
            .scene { height: 480px; }
            .fortune-status { font-size: 1.1rem; }
            .btn-action { font-size: 0.8rem; padding: 8px; }
        }
        
        .container.has-result .input-group { display: none; }
        .container.has-result .scene { display: block; }
        .reset-btn-container { margin-top: 15px; display: none; }
        .container.has-result .reset-btn-container { display: block; }
        
        .btn-reset {
            background: transparent;
            color: white;
            border: 1px solid white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
        }

    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div class="container" id="mainContainer">
        <h1>üîÆ Gieo Qu·∫ª 2026 üîÆ</h1>
        <div class="subtitle">Check VAR v·∫≠n m·ªánh ‚Äì Khai xu√¢n ƒë√≥n l·ªôc</div>

        <div class="input-group" id="inputSection">
            <input type="text" id="userName" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n..." autocomplete="off">
            <input type="number" id="birthYear" placeholder="NƒÉm sinh (VD: 2000)" max="2026">
            <button class="btn-gieo" onclick="castFortune()">üßß Gieo Qu·∫ª Ngay üßß</button>
        </div>

        <!-- 3D Card Scene -->
        <div class="scene" id="cardScene">
            <div class="card" id="card">
                <!-- M·∫∑t Tr∆∞·ªõc -->
                <div class="card__face card__face--front">
                    <div class="front-decor">‚òØÔ∏è</div>
                    <div class="front-text">B√≠nh Ng·ªç<br>2026</div>
                    <div style="font-size: 0.8rem; margin-top: 10px; opacity: 0.8;">Ch·∫°m ƒë·ªÉ l·∫≠t xem</div>
                </div>

                <!-- M·∫∑t Sau (K·∫øt Qu·∫£) -->
                <div class="card__face card__face--back">
                    <!-- Wrapper ƒë·ªÉ ch·ª•p ·∫£nh (lo·∫°i tr·ª´ n√∫t b·∫•m ra) -->
                    <div class="card-content-wrapper" id="captureArea">
                        <div class="card-header">QU·∫∫ S·ªê <span id="fortuneId">#01</span></div>
                        <div class="user-name-display" id="displayUser">T√™n: ... (2000)</div>
                        
                        <div class="fortune-status" id="txtStatus">
                            ƒêang ƒë·ªçc t√≠n hi·ªáu v≈© tr·ª•...
                        </div>

                        <div class="stats-container">
                            <div class="stat-row">
                                <span class="stat-label">üíº S·ª± nghi·ªáp:</span>
                                <span class="stat-value" id="txtCareer">0%</span>
                            </div>
                            <div class="progress-bar"><div class="progress-fill" id="barCareer" style="width: 0%"></div></div>
                            
                            <div style="height: 10px;"></div>

                            <div class="stat-row">
                                <span class="stat-label">üíò T√¨nh c·∫£m:</span>
                                <span class="stat-value" id="txtLove">0%</span>
                            </div>
                            <div class="progress-bar"><div class="progress-fill" id="barLove" style="width: 0%"></div></div>
                        </div>

                        <div class="surprise-box">
                            <div class="surprise-title">‚ú® Bi·∫øn s·ªë b·∫•t ng·ªù ‚ú®</div>
                            <div class="surprise-content" id="txtSurprise">???</div>
                        </div>

                        <div class="advice-quote" id="txtAdvice">
                            "..."
                        </div>
                        <div style="font-size: 0.7rem; color: #ccc; margin-top: 5px;">gieoque2026.vercel.app</div>
                    </div>

                    <!-- N√∫t h√†nh ƒë·ªông -->
                    <div class="action-buttons">
                        <button class="btn-action btn-copy" onclick="copyFortune(event)">
                            üìã Copy Text
                        </button>
                        <button class="btn-action btn-download" onclick="downloadFortune(event)">
                            üì∏ T·∫£i ·∫¢nh
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="reset-btn-container">
            <button class="btn-reset" onclick="resetApp()">üîÑ Gieo l·∫°i qu·∫ª kh√°c</button>
        </div>
    </div>

    <div id="toast">ƒê√£ copy! Share ngay ƒë·ªÉ flex v·∫≠n may ƒë·∫ßu nƒÉm üòé‚ú®</div>

    <script>
        // --- DATA & LOGIC ---
        const fortunes = [
            {
                status: "T√¢m b·∫•t bi·∫øn gi·ªØa d√≤ng ƒë·ªùi v·∫°n bi·∫øn",
                career: 85, love: 40, surprise: "T√¨m th·∫•y t·ªù 500k trong t√∫i √°o c≈©",
                advice: "Ng·ªìi im t√¨nh y√™u s·∫Ω t·ªõi (ho·∫∑c kh√¥ng)."
            },
            {
                status: "Ti·ªÅn v√†o nh∆∞ n∆∞·ªõc s√¥ng ƒê√†",
                career: 99, love: 20, surprise: "S·∫øp tƒÉng l∆∞∆°ng ho·∫∑c... tƒÉng vi·ªác",
                advice: "ƒê·ª´ng l√†m vi·ªác chƒÉm ch·ªâ, h√£y l√†m vi·ªác th√¥ng minh."
            },
            {
                status: "ƒê√†o hoa n·ªü r·ªô, coi ch·ª´ng v·ª° n·ª£ t√¨nh",
                career: 60, love: 100, surprise: "Ng∆∞·ªùi y√™u c≈© m·ªùi ƒëi ƒë√°m c∆∞·ªõi",
                advice: "Y√™u th√¨ y√™u kh√¥ng y√™u th√¨ y√™u."
            },
            {
                status: "Nh√¢n ph·∫©m c·ª±c ƒë·∫°i - Gacha l√† tr√∫ng",
                career: 75, love: 75, surprise: "Tr√∫ng Give away tr√™n Facebook",
                advice: "S·ªëng t·ªët tr·ªùi xanh s·∫Ω an b√†i."
            },
            {
                status: "Deadline d√≠ ch·∫°y t·ª•t qu·∫ßn",
                career: 95, love: 5, surprise: "ƒê∆∞·ª£c kh√°ch h√†ng donate tr√† s·ªØa",
                advice: "Ng·ªß ƒë·ªß 8 ti·∫øng l√† m·ªôt lo·∫°i xa x·ªâ ph·∫©m."
            },
            {
                status: "Over h·ª£p v·ªõi vi·ªác ƒëi du l·ªãch",
                career: 50, love: 90, surprise: "Book ƒë∆∞·ª£c v√© m√°y bay 0 ƒë·ªìng",
                advice: "ƒêi ƒë√¢u c≈©ng ƒë∆∞·ª£c, mi·ªÖn l√† c√≥ ti·ªÅn."
            },
            {
                status: "Tr·∫°ng th√°i: ƒêang ch·ªù t√≠n hi·ªáu v≈© tr·ª•",
                career: 88, love: 88, surprise: "Crush ch·ªß ƒë·ªông rep story",
                advice: "Ki√™n nh·∫´n l√† m·∫π c·ªßa th√†nh c√¥ng."
            },
            {
                status: "C·∫©n th·∫≠n b·ªã thao t√∫ng t√¢m l√Ω",
                career: 70, love: 30, surprise: "Ph√°t hi·ªán ra b√≠ m·∫≠t ƒë·ªông tr·ªùi c·ªßa b·∫°n th√¢n",
                advice: "Tin ng∆∞·ªùi v·ªôi v√£ l√† m·ªôt c√°i t·ªôi."
            },
            {
                status: "NƒÉm nay Flex nh·∫π, sang nƒÉm Flex to",
                career: 92, love: 60, surprise: "Viral tr√™n TikTok sau m·ªôt ƒë√™m",
                advice: "Khi√™m t·ªën l√† ƒë·ªânh cao c·ªßa s·ª± khoe khoang."
            },
            {
                status: "ƒê·ªôc l·∫≠p t·ª± do, ƒÉn no ng·ªß k·ªπ",
                career: 80, love: 0, surprise: "Gi·∫£m c√¢n th√†nh c√¥ng (trong m∆°)",
                advice: "·∫æ l√† xu th·∫ø, kh√¥ng ph·∫£i do kh√¥ng ai y√™u."
            },
            {
                status: "Th·∫ßn th√°i ng√∫t ng√†n, vi·ªác g√¨ c≈©ng xong",
                career: 90, love: 60, surprise: "S·∫øp khen tr∆∞·ªõc to√†n c√¥ng ty",
                advice: "Quan tr·ªçng l√† c√°i th·∫ßn th√°i."
            },
            {
                status: "S·ªë h∆∞·ªüng, n·∫±m kh√¥ng c≈©ng c√≥ ƒÉn",
                career: 50, love: 50, surprise: "ƒê∆∞·ª£c bao tr√† s·ªØa c·∫£ tu·∫ßn",
                advice: "C√≥ l√†m m·ªõi c√≥ ƒÉn (nh∆∞ng ƒë√¥i khi kh√¥ng l√†m v·∫´n c√≥)."
            },
            {
                status: "Tr∆∞·ªüng ban ngo·∫°i giao, ai c≈©ng qu√Ω",
                career: 85, love: 95, surprise: "K·∫øt b·∫°n ƒë∆∞·ª£c v·ªõi idol",
                advice: "Th√™m b·∫°n b·ªõt th√π."
            },
            {
                status: "Chi·∫øn th·∫ßn ch·∫°y deadline",
                career: 98, love: 10, surprise: "Ho√†n th√†nh KPI tr∆∞·ªõc h·∫°n",
                advice: "ƒê·ª´ng ƒë·ªÉ n∆∞·ªõc ƒë·∫øn ch√¢n m·ªõi nh·∫£y."
            },
            {
                status: "V·∫≠n ƒë√†o hoa ·∫≠p ƒë·∫øn c·∫£n kh√¥ng k·ªãp",
                career: 60, love: 99, surprise: "Ra ng√µ g·∫∑p ng∆∞·ªùi y√™u t∆∞∆°ng lai",
                advice: "C∆∞·ªõi v·ª£ ph·∫£i c∆∞·ªõi li·ªÅn tay."
            },
            {
                status: "ƒê·∫°i gia ng·∫ßm, ti·ªÅn ƒë·∫ßy kho",
                career: 88, love: 40, surprise: "Tr√∫ng s·ªë ƒë·ªôc ƒë·∫Øc (gi·∫•c m∆°)",
                advice: "ƒê·ª´ng tr√¥ng m·∫∑t m√† b·∫Øt h√¨nh dong."
            },
            {
                status: "NƒÉm nay ƒëi nh·∫π n√≥i kh·∫Ω c∆∞·ªùi duy√™n",
                career: 70, love: 70, surprise: "Tr√°nh ƒë∆∞·ª£c m·ªôt ki·∫øp n·∫°n drama",
                advice: "M·ªôt ƒëi·ªÅu nh·ªãn l√† ch√≠n ƒëi·ªÅu l√†nh."
            },
            {
                status: "Master Chef t·∫°i gia",
                career: 45, love: 85, surprise: "N·∫•u ƒÉn ngon crush ƒë·ªï ƒë·ª© ƒë·ª´",
                advice: "Con ƒë∆∞·ªùng ng·∫Øn nh·∫•t ƒë·∫øn tr√°i tim l√† qua d·∫° d√†y."
            },
            {
                status: "CEO t∆∞∆°ng lai",
                career: 95, love: 20, surprise: "ƒê∆∞·ª£c ƒë·ªÅ b·∫°t l√™n ch·ª©c",
                advice: "M√¢y t·∫ßng n√†o g·∫∑p m√¢y t·∫ßng ƒë√≥."
            },
            {
                status: "Th√°nh ch·ªët ƒë∆°n",
                career: 80, love: 50, surprise: "SƒÉn sale 1k th√†nh c√¥ng",
                advice: "Mua s·∫Øm l√† ni·ªÅm vui, tr·∫£ n·ª£ l√† n·ªói bu·ªìn."
            }
        ];

        let currentFortune = {};
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playTingSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.5);
        }

        function castFortune() {
            const name = document.getElementById('userName').value.trim();
            const year = document.getElementById('birthYear').value;
            if (!name || !year) {
                alert("B·∫°n ∆°i, nh·∫≠p t√™n v√† nƒÉm sinh ƒë·ªÉ v≈© tr·ª• nh·∫≠n di·ªán nh√©! ü•∫");
                return;
            }
            document.getElementById('mainContainer').classList.add('has-result');
            document.getElementById('displayUser').innerText = `Gia ch·ªß: ${name} - Sinh nƒÉm: ${year}`;

            const randomIndex = Math.floor(Math.random() * fortunes.length);
            const data = fortunes[randomIndex];
            currentFortune = { ...data, id: randomIndex + 1, name: name, year: year };

            document.getElementById('fortuneId').innerText = `QU·∫∫ S·ªê #${randomIndex + 1}`;
            document.getElementById('txtStatus').innerText = data.status;
            document.getElementById('txtCareer').innerText = data.career + "%";
            document.getElementById('barCareer').style.width = data.career + "%";
            document.getElementById('txtLove').innerText = data.love + "%";
            document.getElementById('barLove').style.width = data.love + "%";
            document.getElementById('txtSurprise').innerText = data.surprise;
            document.getElementById('txtAdvice').innerText = `"${data.advice}"`;

            playTingSound();
            fireConfetti();

            setTimeout(() => {
                document.getElementById('card').classList.add('is-flipped');
            }, 500);
        }

        function copyFortune(e) {
            e.stopPropagation(); // NgƒÉn l·∫≠t th·∫ª
            if (!currentFortune.status) return;
            const content = 
`üîÆ QU·∫∫ ƒê·∫¶U NƒÇM 2026 üîÆ
-----------------------
üë§ Gia ch·ªß: ${currentFortune.name} (${currentFortune.year})
‚ú® Status: ${currentFortune.status}
üíº S·ª± nghi·ªáp: ${currentFortune.career}%
üíò T√¨nh c·∫£m: ${currentFortune.love}%
üéÅ Bi·∫øn s·ªë: ${currentFortune.surprise}
üí° L·ªùi khuy√™n: "${currentFortune.advice}"
-----------------------
üëâ Gieo qu·∫ª t·∫°i: gieoque2026.vercel.app`;
            
            navigator.clipboard.writeText(content).then(() => showToast("ƒê√£ copy text! Share ngay th√¥i üòé")).catch(() => showToast("L·ªói copy text r·ªìi üò¢"));
        }

        function downloadFortune(e) {
            e.stopPropagation(); // NgƒÉn l·∫≠t th·∫ª
            const element = document.getElementById('captureArea');
            const btn = e.target;
            const originalText = btn.innerText;
            btn.innerText = "‚è≥ ƒêang t·∫°o ·∫£nh...";
            
            // C·∫•u h√¨nh html2canvas
            html2canvas(element, {
                scale: 2, // TƒÉng ƒë·ªô ph√¢n gi·∫£i cho n√©t
                useCORS: true,
                backgroundColor: "#ffffff",
                logging: false
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `Que-Dau-Nam-${currentFortune.name || '2026'}.png`;
                link.href = canvas.toDataURL("image/png");
                link.click();
                
                btn.innerText = originalText;
                showToast("ƒê√£ t·∫£i ·∫£nh! Post story ngay n√†o üì∏");
            }).catch(err => {
                console.error(err);
                btn.innerText = "L·ªói!";
                showToast("Kh√¥ng t·∫°o ƒë∆∞·ª£c ·∫£nh, th·ª≠ l·∫°i nh√©!");
                setTimeout(() => btn.innerText = originalText, 2000);
            });
        }

        function showToast(msg) {
            const toast = document.getElementById("toast");
            toast.innerText = msg;
            toast.className = "show";
            setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
        }

        function resetApp() {
            document.getElementById('card').classList.remove('is-flipped');
            document.getElementById('mainContainer').classList.remove('has-result');
            document.getElementById('barCareer').style.width = "0%";
            document.getElementById('barLove').style.width = "0%";
        }

        document.getElementById('card').addEventListener('click', function() {
            if(document.getElementById('mainContainer').classList.contains('has-result') && !this.classList.contains('is-flipped')) {
               this.classList.add('is-flipped');
            }
        });

        // --- Confetti ---
        function fireConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const pieces = [];
            const colors = ['#FFD700', '#D72638', '#FFF', '#FF9F1C'];
            for (let i = 0; i < 100; i++) {
                pieces.push({
                    x: Math.random() * canvas.width, y: Math.random() * canvas.height - canvas.height,
                    w: Math.random() * 10 + 5, h: Math.random() * 10 + 5,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    speed: Math.random() * 3 + 2, rotation: Math.random() * 360
                });
            }
            let animationId;
            function update() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                let activeCount = 0;
                pieces.forEach(p => {
                    p.y += p.speed; p.rotation += p.speed;
                    ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rotation * Math.PI / 180);
                    ctx.fillStyle = p.color; ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
                    ctx.restore();
                    if (p.y < canvas.height) activeCount++;
                });
                if (activeCount > 0) animationId = requestAnimationFrame(update);
                else cancelAnimationFrame(animationId);
            }
            update();
        }
        window.addEventListener('resize', () => {
            const c = document.getElementById('confetti-canvas');
            c.width = window.innerWidth; c.height = window.innerHeight;
        });
    </script>
</body>
</html>
